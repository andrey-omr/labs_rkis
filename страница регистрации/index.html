<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <h1>Регистрация</h1>
    <div class="add">
        <input name="email" type="text">
        <br>
        <input name="password" type="text">
        <br>
        <input name="first_name" type="text">
        <br>
        <input name="last_name" type="text">
        <br>
        <button class="btn">Нажать</button>
    </div>

    <div class="responseText"></div>
    <div class="statusText"></div>
    <div class="status"></div>

    <script>

        document.querySelector('.btn').addEventListener('click', function () {
            var request_data = new FormData();
            request_data.append('email', document.querySelector('input[name="email"]').value);
            request_data.append('password', document.querySelector('input[name="password"]').value);
            request_data.append('first_name', document.querySelector('input[name="first_name"]').value);
            request_data.append('last_name', document.querySelector('input[name="last_name"]').value);

            
            var request = new XMLHttpRequest();
            var url = `http://web-app.api-web-tech.local/registration`;
            request.open('POST', url);
            request.send(request_data);
            request.onreadystatechange = (e) => {
                if (request.readyState == 4) {
                    if (request.status == 422) {
                        document.querySelector('.status').textContent = "Пользователь с данным логином уже существует!"
                    }
                    if (request.status == 200) {
                        document.querySelector('.status').textContent = "Регистрация прошла успешно"
                    }
                    responseData = JSON.parse(request.responseText)
                    console.log(responseData)
                    console.log(request.statusText)
                    console.log(request.status)
                    if(document.querySelector('input[name="email"]').value == '') {
                        document.querySelector('input[name="email"]').value = "Обязательное поле"
                    }
                    if(document.querySelector('input[name="password"]').value == '') {
                        document.querySelector('input[name="password"]').value = "Обязательное поле"
                    }
                    if(document.querySelector('input[name="first_name"]').value == '') {
                        document.querySelector('input[name="first_name"]').value = "Обязательное поле"
                    }
                    if(document.querySelector('input[name="last_name"]').value == '') {
                        document.querySelector('input[name="last_name"]').value = "Обязательное поле"
                    }
                }
            }

        })
    </script>
</body>

</html>